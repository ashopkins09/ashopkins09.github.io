<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Photo-Realistic Bubble Wrap</title>
<style>
  :root {
    --bubble-size: 84px;  /* size in pixels */
    --gap: 18px;          /* spacing between bubbles */
    --rows: 8;            /* adjust to fit */
    --cols: 10;
  }
  html, body {
    margin:0;
    height:100%;
    overflow:hidden;
    background:#ccc;
  }
  #sheet {
    position:relative;
    width:100%;
    height:100%;
    background: url('https://www.photos-public-domain.com/wp-content/uploads/2018/05/bubble-wrap-texture-2.jpg') center center / cover no-repeat;
  }
  .bubble-grid {
    position:absolute;
    top:0; left:0;
    width:100%; height:100%;
    display:grid;
    grid-template-columns: repeat(var(--cols), var(--bubble-size));
    grid-template-rows: repeat(var(--rows), var(--bubble-size));
    gap: var(--gap);
    justify-content:center;
    align-content:center;
  }
  .bubble {
    width: var(--bubble-size);
    height: var(--bubble-size);
    border-radius:50%;
    position:relative;
    cursor:pointer;
    overflow:hidden;
  }
  .bubble::before {
    content:"";
    position:absolute;
    inset:0;
    background-image: url('https://www.photos-public-domain.com/wp-content/uploads/2018/05/bubble-wrap-texture-2.jpg');
    background-repeat: no-repeat;
    border-radius:50%;
    transition: transform 0.2s ease, filter 0.2s ease;
  }
  .bubble.popped::before {
    transform: scaleY(0.8);
    filter: brightness(0.85) contrast(1.2);
  }
  .bubble.popped::after {
    content:"";
    position:absolute;
    inset:0;
    border-radius:50%;
    background: repeating-linear-gradient(45deg,
      rgba(0,0,0,0.06) 0px, rgba(0,0,0,0.06) 2px,
      rgba(255,255,255,0.06) 2px, rgba(255,255,255,0.06) 4px);
    opacity:0.25;
    pointer-events:none;
  }
</style>
</head>
<body>
  <div id="sheet">
    <div class="bubble-grid" id="grid"></div>
  </div>

<script>
const grid = document.getElementById('grid');
const rows = parseInt(getComputedStyle(document.documentElement).getPropertyValue('--rows'));
const cols = parseInt(getComputedStyle(document.documentElement).getPropertyValue('--cols'));
const bubbleSize = parseInt(getComputedStyle(document.documentElement).getPropertyValue('--bubble-size'));
const gap = parseInt(getComputedStyle(document.documentElement).getPropertyValue('--gap'));

let last = null;

// Get the actual rendered background size & position of #sheet
function getSheetBackgroundData() {
  const sheetRect = document.getElementById('sheet').getBoundingClientRect();
  return { left: sheetRect.left, top: sheetRect.top, width: sheetRect.width, height: sheetRect.height };
}

function buildGrid() {
  grid.innerHTML = '';
  const sheetData = getSheetBackgroundData();

  for(let r=0; r<rows; r++){
    for(let c=0; c<cols; c++){
      const bubble = document.createElement('div');
      bubble.className = 'bubble';

      // Calculate background position to crop correct part of the image
      const offsetX = c * (bubbleSize + gap);
      const offsetY = r * (bubbleSize + gap);

      bubble.style.setProperty('--bgX', `-${offsetX}px`);
      bubble.style.setProperty('--bgY', `-${offsetY}px`);

      const before = document.createElement('style');
      // Inject a specific rule for this bubbleâ€™s ::before
      before.textContent = `
        .bubble:nth-child(${r*cols + c + 1})::before {
          background-size: ${sheetData.width}px ${sheetData.height}px;
          background-position: calc(${offsetX * -1}px) calc(${offsetY * -1}px);
        }
      `;
      document.head.appendChild(before);

      bubble.addEventListener('click', ()=>{
        if(last && last !== bubble) last.classList.remove('popped');
        bubble.classList.toggle('popped');
        last = bubble.classList.contains('popped') ? bubble : null;
      });

      grid.appendChild(bubble);
    }
  }
}

buildGrid();
window.addEventListener('resize', buildGrid);
</script>
</body>
</html>
